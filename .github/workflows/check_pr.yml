name: PR validation

on: pull_request

jobs:
  validate_pr:
    name: Validate PR
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - uses: dorny/paths-filter@v2
        id: changes
        with:
          filters: |
            merged_csvs:
              - './merged_cells_*.csv'

      - name: Warn of merged cells changes
        if: steps.changes.outputs.merged_csvs == 'true'
        uses: thollander/actions-comment-pull-request@v1
        with:
          message: |
            Hey there! :wave:

            It looks like your PR directly modifies a merged CSV file. :thinking:

            These files are automatically [generated by GitHub Actions](https://github.com/davwheat/nsg-cell-database/actions/workflows/merge_csvs.yml), so any changes you make to this file won't be kept.

            If you're looking to add/remove cells from one of these CSVs, please do so from the source files inside the `fragments` folder.

            For more info, check out the [contributing information in the repository README](https://github.com/davwheat/nsg-cell-database#contributing)!
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

          
      - uses: actions-ecosystem/action-add-labels@v1
        if: steps.changes.outputs.merged_csvs == 'true'
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          labels: |
            invalid

      - uses: actions-ecosystem/action-remove-labels@v1
        if: steps.changes.outputs.merged_csvs != 'true'
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          labels: |
            invalid